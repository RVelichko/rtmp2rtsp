#!/bin/sh

. daemonize

usage() {
    echo "Usage: $(basename $0) [OPTIONS] <FLV_LOCATION> <FLV_HOST> <FLV_PORT> <RTP_HOST> <RTP_PORT> <COMMAND>"
    echo ""
    exit 0
}

[ $# -ne 6 ] && usage

flv_location=$1
flv_host=$2
flv_port=$3
rtp_host=$4
rtp_port=$5
cmd=$6

stream_root=$(make_hash $flv_location $flv_host $flv_port)
stream_leaf=$(make_hash $flv_location $flv_host $flv_port $rtp_host $rtp_port)

case $cmd in
    start)
        daemon_start $stream_root $stream_leaf "rtp2rtp $flv_location $flv_host $flv_port $rtp_host $rtp_port"
        ;;
    stop)
        daemon_stop $stream_root $stream_leaf
        ;;
    status)
        status $stream_root $stream_leaf
        ;;
    info)
        echo "$(path_to_stream $stream_root) $stream_leaf"
        ;;
    *)  usage
        ;;
esac
